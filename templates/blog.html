<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="ui large top fixed menu">
        <div class="ui container">
            <a class="active_item" href="/">Hermes Hat</a>
            <div class="right menu">
                <!-- <a class="item" href="/economics">Economics</a> -->
                <a class="item" href="/photographs">Photography</a>
                <a class="item" href="/media">Media</a>
                <a class="item" href="/about">About</a>
                {% if not g.user_logged_in %}
                    <a class="item" href="/login">
                        <i class="fas fa-lock"></i>
                    </a>
                {% else %}
                    <a class="item" href="/logout">
                        <i class="fas fa-unlock"></i>
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
    <div style="display: flex;">
        <!-- Main Blog Content -->
        <div id="blog-content" style="width: 66%;">
            <!-- <div id="highlight-icons">
                <button id="positive"><div class="tooltip">Highlight text as positive</div>+</button>
                <button id="negative"><div class="tooltip">Highlight text as negative</div>-</button>
                <button id="questionable"><div class="tooltip">Highlight text as questionable</div>?</button>
            </div> -->                 
            <div id="content-area">
                {{ content_html | safe }}
            </div>
        </div>

        <!-- Sidebar for Related Links and Comments -->
        <div id="sidebar" style="width: 34%; gap: 20px;">

            <!-- Related Links Section -->
            <div id="related-links" class="sidebar-section" style="height: 300px; overflow-y: auto;">
                {% if related_links %}
                <h3>Related Links</h3>
                <div class="inner-box" style="height: fit; overflow-y: auto;">
                    <ul>
                        {% for link in related_links %}
                        <li><a href="{{ link }}" target="_blank">{{ link }}</a></li>
                        {% endfor %}
                    </ul>
                {% endif %}
                </div>
            </div>
            
            <!-- Comments Section 
            <div id="comments" class="sidebar-section">
                <h3>Comments - Coming Soon!</h3>
                <div class="inner-box">
                    <div id="newCommentBox" class="new-comment-box hidden"> 
                        <textarea id="newCommentText" rows="4"></textarea>
                        <div class="comment-buttons">
                            <button id="cancelComment" class="btn btn-secondary">Cancel</button>
                            <button id="submitComment" class="btn btn-primary">Submit</button>
                        </div>
                    </div>
                </div>
            </div> -->
            <!-- video Section -->
            <div id="related_videos" class="sidebar-section" style="overflow-y: auto;">
                <h3>Related Videos</h3>
                <div class="video-scroll-container">
                    <!-- Videos will be dynamically loaded here -->
                </div>
            </div>
        </div>
    </div>


    <!-- JavaScript for Highlighting and Commenting -->
    <script>
        
        $(document).ready(function() {

            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            }
            
            $("#addCommentIcon").click(function() {
                const userLoggedIn = getCookie('user_logged_in');
                if (!userLoggedIn) {
                    window.location.href = "/login";
                    console.log("User not logged in");
                    return;
                }
                $(".inner-box").html(`
                    <textarea id="commentText"></textarea>
                    <button id="submitComment">Submit</button>
                    <button id="cancelComment">Cancel</button>
                `);
            });
        
            // Event delegation for dynamically created elements
            $(".inner-box").on('click', '#submitComment', function() {
                let commentText = $("#commentText").val();
                $.post("/add_comment", {
                    blog_post_id: "your_blog_post_id_here",
                    user_id: "your_user_id_here",
                    comment_text: commentText
                }).done(function(data) {
                    if (data.status === "success") {
                        // TODO: Add comment to the list of existing comments or do other UI updates
                    }
                });
            });
        
            $(".inner-box").on('click', '#cancelComment', function() {
                $(".inner-box").html(''); // Clear the comment box
            });
            // Submit new comment
            $('#submitComment').click(function() {
                let commentText = $("#commentText").val();
                $.post("/add_comment", {
                    blog_post_id: "your_blog_post_id_here",
                    user_id: "your_user_id_here",
                    comment_text: commentText
                }).done(function(data) {
                    if (data.status === "success") {
                        // Add comment to the list of existing comments or do other UI updates
                    }
                });
            });

            // Cancel new comment
            $('#cancelComment').click(function() {
                $('#newCommentBox').addClass('hidden'); // Hide the comment box
                $('#newCommentText').val(''); // Clear the textarea
            });
            // Assuming you have a route named '/api/youtube_details' that returns video details
            $.get('/api/youtube_details?section=economics', function(data) {
                const videoContainer = $('.video-scroll-container');
                data.forEach(video => {
                    const videoElement = `
                        <div class="video-wrapper">
                            <iframe width="250" height="140" src="https://www.youtube.com/embed/${video.video_id}" frameborder="0" allowfullscreen></iframe>
                            <div class="video-title">${video.title}</div>
                            <div class="video-channel">${video.channel}</div>
                        </div>`;
                    videoContainer.append(videoElement);
                });
                adjustVideoHeight();
            });
            // Adjust the video section height
            function adjustVideoHeight() {
                let blogHeight = $('#blog-content').height();
                let relatedHeight = $('#related-links').height();
                let videoHeight = blogHeight - relatedHeight;
                $('.video-scroll-container').height(videoHeight);
            }

            adjustVideoHeight(); // Call it initially

            // Update height when window is resized
            $(window).on('resize', adjustVideoHeight);
        });
    </script>
</body>
</html>